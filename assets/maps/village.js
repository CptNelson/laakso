// Constructor for ruined village

Game.Map.Village = function (tiles, player) {
    // Call the Map constructor
    Game.Map.call(this, tiles);


    var villageMap = [['.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.'],
    ['.', '#', '#', '#', '#', '#', '#', '#', '#', '#', '☼', '☼', '☼', '☼', '#', '#', '#', '#', '#', '#', '.', '.', '.', '#', '#', '#', '#', '#', '#', '.', '.', '.', '.', '.', '#', '#', '#', '#', '#', '.'],
    ['.', '#', '.', '.', '.', '.', '.', '.', '.', '#', '☼', '☼', '☼', '.', '■', '.', '.', '.', '.', '#', '.', '.', '.', '#', '.', '.', '.', '.', '#', '.', '.', '▲', '.', '.', '#', '.', '.', '.', '#', '.'],
    ['.', '#', '.', '.', '.', '.', '.', '.', '.', '#', '☼', '☼', '☼', '☼', '#', '.', '.', '.', '.', '#', '.', '.', '.', '#', '.', '.', '.', '.', '#', '.', '.', '.', '.', '.', '#', '.', '.', '.', '#', '.'],
    ['.', '#', '.', '.', '.', '.', '.', '.', '.', '#', '☼', '☼', '☼', '☼', '#', '.', '.', '.', '.', '#', '.', '.', '.', '#', '.', '.', '.', '.', '#', '.', '.', '.', '.', '.', '#', '.', '.', '.', '#', '.'],
    ['.', '#', '.', '#', '#', '.', '.', '.', '.', '#', '.', '.', '#', '#', '#', '.', '.', '.', '.', '#', '.', '.', '.', '■', '.', '.', '.', '.', '#', '.', '.', '.', '.', '.', '#', '.', '.', '.', '#', '.'],
    ['.', '#', '.', '.', '#', '.', '.', '.', '.', '#', '.', '.', '#', '.', '.', '.', '.', '.', '.', '#', '.', '.', '.', '#', '#', '#', '#', '#', '#', '.', '.', '.', '.', '.', '■', '.', '.', '.', '#', '.'],
    ['.', '#', '.', '.', '#', '.', '.', '.', '.', '#', '.', '.', '#', '.', '.', '.', '.', '.', '.', '#', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '#', '.', '.', '.', '#', '.'],
    ['.', '#', '.', '.', '#', '.', '.', '.', '.', '#', '.', '.', '#', '.', '.', '.', '.', '.', '.', '#', '.', '.', '.', '.', '.', '#', '#', '#', '#', '#', '#', '#', '.', '.', '#', '.', '.', '.', '#', '.'],
    ['.', '#', '#', '#', '#', '■', '#', '#', '#', '#', '.', '.', '#', '#', '#', '#', '■', '#', '#', '#', '.', '.', '.', '.', '.', '#', '.', '.', '.', '.', '.', '#', '.', '.', '#', '#', '#', '#', '#', '.'],
    ['.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '#', '.', '#', '.', '.', '.', '.', '.', '.', '.', '#', '.', '.', '.', '.', '.', '#', '.', '.', '.', '.', '.', '.', '.', '.'],
    ['.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '#', '.', '.', '.', '.', '.', '#', '.', '.', '.', '.', '.', '.', '.', '.'],
    ['.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '■', '.', '.', '.', '.', '.', '#', '.', '.', '.', '.', '.', '.', '▲', '.'],
    ['.', '.', '▲', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '#', '.', '.', '.', '.', '.', '#', '.', '.', '.', '.', '.', '.', '.', '.'],
    ['.', '▲', '.', '▲', '.', '#', '#', '#', '#', '■', '■', '#', '#', '#', '#', '.', '.', '.', '.', '#', '#', '#', '#', '#', '#', '#', '.', '.', '.', '.', '.', '#', '.', '.', '#', '■', '#', '#', '#', '.'],
    ['.', '.', '.', '.', '.', '#', '.', '.', '.', '.', '.', '.', '.', '.', '#', '.', '.', '.', '.', '#', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '#', '.', '.', '#', '.', '.', '.', '#', '.'],
    ['.', '.', '.', '.', '.', '#', '.', '.', '.', '.', '.', '.', '.', '.', '#', '.', '.', '.', '.', '#', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '#', '.', '.', '#', '.', '.', '.', '#', '.'],
    ['.', '.', '.', '.', '.', '#', '.', '.', '.', '.', '.', '.', '.', '.', '#', '.', '.', '▲', '.', '#', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '#', '.', '.', '#', '.', '.', '.', '#', '.'],
    ['.', '.', '.', '.', '.', '#', '.', '.', '.', '.', '.', '.', '.', '.', '#', '.', '.', '.', '.', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '.', '.', '#', '#', '#', '#', '#', '.'],
    ['.', '.', '.', '.', '.', '#', '.', '.', '.', '.', '.', '.', '.', '.', '#', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.']];

    // this._tiles is reversed [y][x]
    for (x = 0; x < villageMap.length; x++) {
        for (y = 0; y < villageMap[0].length; y++) {
            if (villageMap[x][y] == '#') {
                this._tiles[0][y + 10][x + 10] = Game.Tile.wallTile;
            } else this._tiles[0][y][x] = Game.Tile.floorTile;
        }
    }
    // change some of the wall tiles to tree and wall tiles
    for (x = 0; x < villageMap.length; x++) {
        for (y = 0; y < villageMap[0].length; y++) {
            if (villageMap[x][y] == '#') {
                i = Math.floor(Math.random() * (11))
                if (i > 3) {
                    this._tiles[0][y + 10][x + 10] = Game.Tile.floorTile;
                }
                if (i > 8) {
                    this._tiles[0][y + 10][x + 10] = Game.Tile.treeTile;
                }
            }
        }
    }
    //grow more trees from existing ones. 
    for (times = 0; times < 4; times++) {
        for (x = 0; x < this._tiles[0].length; x++) {
            for (y = 0; y < this._tiles[0][0].length; y++) {
                if (this._tiles[0][y][x] == Game.Tile.treeTile) {
                    i = Math.floor(Math.random() * (4))
                    if (i == 1) {
                        console.log("asd");

                        var xOffset = Math.floor(Math.random() * 3) - 1;
                        var yOffset = Math.floor(Math.random() * 3) - 1;
                        if (xOffset != 0 || yOffset != 0) {

                              this._tiles[0][y + xOffset][x + yOffset] = Game.Tile.treeTile;
                        }
                    }
                }

            }
        }
    }

    for (x = 0; x < this._tiles[0][0].length; x++) {
        for (y = 0; y < this._tiles[0].length; y++) {
            i = Math.floor(Math.random() * (25))
            if (i == 8) {
                  this._tiles[0][y][x] = Game.Tile.yellowTreeTile;
            }
            if (i == 9) {
                 this._tiles[0][y][x] = Game.Tile.treeTile;
            }
            if (this._tiles[0][y][x] == Game.Tile.floorTile) {
                b = Math.floor(Math.random() * (6))
                if (b == 1) {
                    this._tiles[0][y][x] = Game.Tile.yellowBushTile;    
                }           
            }
        }
    }



    this.addEntityAtRandomPosition(player, 0);
    for (items = 0; items < 4; items++) {
        player.addItem(Game.ItemRepository.createRandom())
    }
    for (i = 0; i < 4; i++) {
        var entity = Game.EntityRepository.createRandom();
        entity._name = Game.NameGenerator();
        this.addEntityAtRandomPosition(entity, 0);

    }

};
Game.Map.Village.extend(Game.Map);
